"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[4338],{91095:(e,s,i)=>{i.r(s),i.d(s,{default:()=>Ls});var t=i(59496),a=i(9315),n=i(60823),r=i(55740),c=i(32594),l=i(549),d=i(16513),o=i(49730),u=i(57265),m=i(12773),f=i(96481),g=i(36012),h=i(57115),x=i(42582),b=i(84875),j=i.n(b),p=i(64641),y=i(76163),N=i(68370),v=i(13390),k=i(80644),C=i(71961),E=i(55862),I=i(88758),S=i(98461),w=i(93399),L=i(86695),D=i(41567),O=i(4699),T=i(5050),A=i(91560),F=i(55207),M=i(37859),_=i(51265);const B=e=>{if(!Number.isInteger(e))return"";const s=Date.now()-Number(e),i=Math.round(s/1e3/60),t=Math.round(s/1e3/60/60),a=Math.round(s/1e3/60/60/24),n=Math.round(s/1e3/60/60/24/7);return a>=7?r.ag.get("time.weeks.short",n):t>=24?r.ag.get("time.days.short",a):i>=60?r.ag.get("time.hours.short",t):i>0?r.ag.get("time.minutes.short",i):r.ag.get("time.now")};var U=i(4637);const P=e=>{const{timestamp:s,isNowPlaying:i}=e;return i?(0,U.jsx)(f.ws,{label:r.ag.get("time.now"),children:(0,U.jsx)(_.h,{"aria-label":r.ag.get("time.now"),iconSize:16})}):(0,U.jsx)("span",{children:B(s)})},z="gj9SOnCIzruGWAM5m3XO",J="VLKqDIGaQn2bILzJKSZ0",R="oWQvtc5QZlmB60A9ejJx",Y="dLg5WMgjh1kfYtZ_MnZz",Z="VBQoaks4ZkfIknTKmxXZ",K="Irsd58UNEmDPxdhXKXCs",H="_Xe25F2aC59Kljgqyw3G",q="P7j2kCLc27vLybuzy5XB",W="ktMuChpoidaEvECE7y8f",Q="LywlKLgNaEtHZzLM3EX5",V="mthrc5U9wb8F4zMBqlPy",G="dvb9y9hcP8sUfMhUASKO",X="kE5DI3BkNlo9zuO7K3aO",$="hnEmEncF7kB2TnE_Uyja",ee="j7K7_Zly3G1HS9MlKoao",se="gY0qK1gmEdhq5idwQc8C",ie="MObmOrMxbQpO10ebAtZA",te="cBPbfBWIIPDzhIT6i3ih",ae="PjDcsgAPmXlcTBJRGpIu",ne="IRpPQFA57qgQ5jicWWaD",re="Hm3nIbegLclY1uCAmnx_",ce="bhRoVUHjWdo9mgUkU6fe",le="BliqfY7vu_qE2C9zs5Ou",de="qdYWuHZd4HdSWfd4pSQB",oe="DhvYWKjDc7uyF3HfkDJJ",ue="ralK8s_OmE8a8zWcfNKM",me=e=>Date.now()-e<9e5,fe=(e,s)=>{const i=(0,y.EC)(e)?.type;switch(i){case y.JM.PLAYLIST:case y.JM.PLAYLIST_V2:return(0,U.jsx)(C.X,{uri:e});case y.JM.EPISODE:case y.JM.SHOW:return(0,U.jsx)(E.M,{uri:e});case y.JM.ALBUM:return(0,U.jsx)(v.Y,{uri:e,artistUri:s});case y.JM.ARTIST:return(0,U.jsx)(k.m,{uri:e});default:return null}},ge=e=>{switch(e){case y.JM.ALBUM:return M.p.ALBUM;case y.JM.ARTIST:return M.p.ARTIST;case y.JM.SHOW:return M.p.SHOW;case y.JM.EPISODE:return M.p.EPISODE;case y.JM.PLAYLIST:case y.JM.PLAYLIST_V2:return M.p.PLAYLIST;default:return}},he=e=>{const{show:s=!0,spec:i,friend:a}=e,n=(0,t.useMemo)((()=>a.user.imageUrl?[{url:a.user.imageUrl,width:0,height:0}]:[]),[a.user.imageUrl]),c=(0,u.o)(),l=(0,h.$P)(),d=a.track,o=d.uri,m=d?.context?.uri,{usePlayContextItem:f}=(0,F.n)({uri:m},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),{togglePlay:g,isPlaying:x,isActive:b}=f({uri:o}),v=(0,y.EC)(d.context?.uri),C=v?.type,E=(0,t.useCallback)((()=>{g(),c({intent:x?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:o});const e=i.friendRowFactory().playButtonFactory();b?x?l.logInteraction(e.hitPause({itemToBePaused:o})):l.logInteraction(e.hitResume({itemToBeResumed:o})):l.logInteraction(e.hitPlay({itemToBePlayed:o}))}),[g,c,x,o,i,b,l]),M=(0,t.useCallback)(((e,s)=>{l.logInteraction(i.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:s}))}),[l,i]),_=(0,D.O)([o],d.name),B=(0,D.O)([d.artist?.uri],d.artist?.name),J=(0,D.O)([d.context?.uri],d.context?.name);return s?(0,U.jsxs)("div",{className:j()(z),children:[(0,U.jsx)(O._,{menu:fe(d.context?.uri,d.artist?.uri),children:(0,U.jsxs)("div",{className:Y,children:[(0,U.jsx)(N.q,{label:a.user.name,width:40,userIconSize:16,images:n,withBadge:me(a.timestamp)}),(0,U.jsx)(L.I,{className:Z,iconClassName:K,isPlaying:x,isLocked:!1,onClick:E,playAriaLabel:x?r.ag.get("pause"):`${r.ag.get("play")} ${d.artist.name} ${d.name}`})]})}),(0,U.jsxs)("div",{className:j()(H),children:[(0,U.jsxs)("div",{className:q,children:[(0,U.jsx)(p.D,{as:"p",variant:"mestoBold",className:j()(W,"ellipsis-one-line"),children:(0,U.jsx)(A.ZP,{value:"/buddyfeed_user_profile",children:(0,U.jsx)(O._,{menu:(0,U.jsx)(S.I,{uri:a.user.uri}),children:(0,U.jsx)(w.Link,{title:a.user.name,to:a.user.uri,dir:"auto",onClick:()=>M("profile_link",a.user.uri),children:a.user.name})})})}),(0,U.jsx)(p.D,{as:"p",variant:"finale",className:j()(Q),children:(0,U.jsx)(P,{timestamp:a.timestamp,isNowPlaying:me(a.timestamp)})})]}),(0,U.jsxs)(p.D,{as:"p",variant:"finale",className:V,children:[(0,U.jsx)(A.ZP,{value:"/buddyfeed_track",children:(0,U.jsx)(O._,{menu:(0,U.jsx)(I.$,{uri:d.uri,contextUri:d.context?.uri,albumUri:d.album?.uri,artists:[d.artist]}),children:(0,U.jsx)(w.Link,{title:d.name,to:o,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:_,onClick:()=>M("track_link",o),children:d.name})})}),(0,U.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,U.jsx)(A.ZP,{value:"/buddyfeed_artist",children:(0,U.jsx)(O._,{menu:d.artist?(0,U.jsx)(k.m,{uri:d.artist.uri}):null,children:(0,U.jsx)(w.Link,{title:d.artist?.name,to:d.artist?.uri,className:"ellipsis-one-line",dir:"auto",draggable:!0,onDragStart:B,onClick:()=>M("artist_link",d.artist?.uri),children:d.artist?.name})})})]}),(0,U.jsx)(p.D,{as:"p",variant:"finale",className:j()("ellipsis-one-line",X),children:(0,U.jsx)(A.ZP,{value:"/buddyfeed_context",children:(0,U.jsx)(O._,{menu:fe(d.context?.uri,d.artist?.uri),children:(0,U.jsxs)(w.Link,{title:d.context?.name,to:d.context?.uri,className:$,draggable:!0,onDragStart:J,onClick:()=>M("context_link",d.context?.uri),children:[(0,U.jsx)(T.t,{type:ge(C),iconSize:16,className:G}),(0,U.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:d.context?.name})]})})})})]})]},a.user.uri):null};function xe({friends:e,spec:s}){return(0,U.jsx)(x.U5,{flipKey:e.map((e=>e.user.uri)).join(""),children:(0,U.jsx)("ol",{children:e.map(((e,i)=>(0,U.jsx)(x.$3,{flipId:e.user.uri,children:(0,U.jsx)("li",{children:(0,U.jsx)(he,{friend:e,show:i<100,spec:s},e.user.uri)})},e.user.uri)))})})}var be=i(97872),je=i(89120),pe=i(98984),ye=i(76376),Ne=i(39871),ve=i(85830),ke=i(66847),Ce=i(73355),Ee=i(11466),Ie=i(22699),Se=i(92956);const we="w5nHQ74JGTytKwWanjvB",Le="u11kJflcqt7CSXo9qL_T",De="MmENkh6tW0MyjTtTtPHZ",Oe="Gl0dkNQbAyNjVZ1IpghI",Te=({name:e,following:s,imageUrl:i,uri:n})=>{const c=(0,Ie.q)(),l=(0,u.o)(),d=t.createRef(),[o,f]=(0,t.useState)(s);(0,Se.d)(Ee.rA.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(n))switch(e.data.operation){case Ee.BM.FOLLOW_USER:f(!0);break;case Ee.BM.UNFOLLOW_USER:f(!1)}}));const g=(0,t.useCallback)((()=>{o?c.unfollowUsers([n]):(c.followUsers([n]),l({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),d.current&&d.current.blur()}),[o,d,n,c,l]);return(0,t.useEffect)((()=>{f(s)}),[s]),(0,U.jsxs)("div",{className:we,children:[(0,U.jsx)(N.q,{label:e,width:40,userIconSize:16,images:(0,t.useMemo)((()=>[{width:40,height:40,url:i}]),[i])}),(0,U.jsxs)("div",{className:j()(Le,"ellipsis-one-line"),children:[(0,U.jsx)(p.D,{as:"p",variant:"mestoBold",className:"ellipsis-one-line",children:e}),o&&(0,U.jsx)(p.D,{as:"p",variant:"finale",className:"ellipsis-one-line",children:r.ag.get("following")})]}),(0,U.jsx)("div",{className:De,children:(0,U.jsx)(m.E,{className:Oe,size:"sm",ref:d,onClick:g,ariaLabel:o?r.ag.get("buddy-feed.button.remove-friend"):r.ag.get("buddy-feed.button.add-friend"),icon:o?Ce.k:a.t})})]})},Ae="nGInMrf62TCFD9MBnEzz";function Fe({facebookFriends:e}){return(0,U.jsx)("div",{className:Ae,children:e.map((({uri:e,following:s,title:i,image:t})=>(0,U.jsx)(Te,{uri:e,name:i,imageUrl:t,following:s},`fb-friend-${e}`)))})}var Me=i(81937);const _e="n6rSk6R7nfmSGSgTRR5_";function Be(){return(0,U.jsx)("div",{className:_e,children:Array(20).fill(0).map(((e,s)=>(0,U.jsx)(Me.C,{isLoading:!0,charCount:100,as:"p",variant:"canon"},s)))})}var Ue=i(9102),Pe=i(5846);const ze="pZFwflwH1vXVCmAO5vbz",Je="yPL55nV5rC97vJhAf7ke",Re="qpgo9DQ9rVZbO5pLJog5",Ye="A3hvkJOGkBNa6zWj6oZa",Ze="pIyez6N1SF3jW0U5VUx4",Ke="lIxuZR4lYTrEKkMYedty",He="VEmC3OHK3uAasHvO5OuA",qe="wzGPtuvvLpOpY1PDu4Qv",We="YoJTUV4hazVCFNbfKoNq",Qe=({onBackButtonClick:e})=>{const[s,i]=(0,t.useState)(""),{isLoading:a,friends:n}=(e=>{const s=(0,Pe.I)(),i=e.trim().toLowerCase(),{data:t,isLoading:a}=(0,Ue.useQuery)("useFacebookFriends",(async()=>(await s.fetchFacebookFriends()).sort(((e,s)=>e.title>s.title?1:-1))));return{isLoading:a,friends:t?.filter((({title:e})=>-1!==e.trim().toLowerCase().indexOf(i)))??[]}})(s),c=(0,ve.y1)((e=>{i(e.target.value)}),100),l=(0,t.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,U.jsxs)("div",{className:ze,children:[(0,U.jsx)(m.E,{ariaLabel:r.ag.get("buddy-feed.button.back"),onClick:e,ref:l,className:Je,icon:be.e,size:"sm",testId:"back-to-friends"}),(0,U.jsxs)("div",{className:Re,children:[(0,U.jsx)("div",{className:Ye,children:(0,U.jsx)(pe.z,{className:Ze,iconSize:32})}),(0,U.jsx)("div",{className:Ke,children:a?(0,U.jsx)(Me.C,{isLoading:!0,charCount:25,as:"p",variant:"mesto"}):(0,U.jsx)(p.D,{as:"p",variant:"mesto",children:r.ag.get("buddy-feed.number-of-friends",n.length)})})]}),a?(0,U.jsx)(Be,{}):(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)("div",{className:He,children:[(0,U.jsx)(ke.j,{className:We,iconSize:16,role:"presentation"}),(0,U.jsx)("input",{onChange:c,className:qe,placeholder:r.ag.get("buddy-feed.find-in-playlists")})]}),(0,U.jsx)(Fe,{facebookFriends:n})]})]})};var Ve=i(37344);function Ge({isOpen:e,onClose:s,onConfirm:i}){return(0,U.jsx)(Ve.Q,{onClose:s,"aria-label":r.ag.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:i,titleText:r.ag.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:r.ag.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:r.ag.get("queue.cancel-button"),confirmText:r.ag.get("web-player.buddy-feed.connect-button"),isOpen:e})}let Xe=function(e){return e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e}({});const $e="EmZCbU1_B_J9RAHebolL",es="Ym6Yyx83U7mNKOMw9dxw",ss="NXcZaSipzomJ6d4_nM94",is="b9rqRkvRvhrSY4FYHQVC",ts="xHc_2FQr3NxfCgfDSVhY",as="QAJYN0xWh3h2A5d8_C1g",ns="PKhH1CknobkjJdVITsb4",rs="HgRmCE3NxfiYNtv6pF3H",cs="HnA5mipUMkheAlbxqCn_",ls="mvp0xhvZTo0xv0TIwi9u",ds=e=>{const s=(0,u.o)(),{onBackButtonClick:i,feedIsEmpty:a,goToAddFriends:n=!1}=e,c=function(){const e=(0,Pe.I)(),[s,i]=(0,t.useState)(Xe.LOADING);return(0,t.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{i(e.connection?Xe.CONNECTED:Xe.DISCONNECTED)})).cancel),[e]),s}(),l=(0,Pe.I)(),[d,o]=(0,t.useState)(!1),[f,g]=(0,t.useState)(!1),[h,x]=(0,t.useState)(!1),b=(0,t.useCallback)((e=>{null!==e&&e.focus()}),[]),j=(0,t.useCallback)((()=>{location.reload()}),[]);if(f)return(0,U.jsxs)("div",{className:cs,children:[(0,U.jsx)(m.E,{onClick:i,ref:b,className:ss,ariaLabel:r.ag.get("buddy-feed.button.back"),icon:be.e,size:"sm"}),(0,U.jsxs)("div",{className:ls,children:[(0,U.jsx)(p.D,{as:"h1",variant:"balladBold",className:es,children:r.ag.get("error-dialog.generic.header")}),(0,U.jsx)(p.D,{as:"p",variant:"mesto",className:is,children:r.ag.get("error-dialog.generic.body")}),(0,U.jsx)(je.D,{colorSet:"invertedLight",onClick:j,children:r.ag.get("error.reload")})]})]});const y=(n||h)&&c===Xe.CONNECTED;return(0,U.jsxs)("div",{className:$e,children:[y&&(0,U.jsx)(Qe,{onBackButtonClick:()=>{a&&x(!1),i()}}),!y&&(0,U.jsxs)("div",{className:as,children:[(0,U.jsx)(m.E,{ariaLabel:r.ag.get("buddy-feed.button.back"),onClick:i,className:ss,ref:b,icon:be.e,size:"sm"}),(0,U.jsx)(p.D,{as:"h1",variant:"balladBold",className:es,children:r.ag.get("buddy-feed.friend-activity")}),(0,U.jsx)(p.D,{as:"p",variant:"mesto",className:is,children:r.ag.get("buddy-feed.facebook.connect-with-friends-default")}),(0,U.jsx)("div",{className:ns,children:(0,U.jsx)(je.D,{className:rs,buttonSize:"sm",iconLeading:pe.z,UNSAFE_colorSet:(0,ye.Ev)("#2374E1",Ne.$_Y.white),onClick:()=>{s({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),c!==Xe.CONNECTED?o(!0):x(!0)},children:r.ag.get("buddy-feed.facebook.button")})}),(0,U.jsx)(p.D,{as:"p",variant:"finale",className:ts,children:r.ag.get("buddy-feed.facebook.disclaimer")}),(0,U.jsx)(Ge,{isOpen:d,onClose:()=>{o(!1)},onConfirm:()=>{l.connectToFacebook().then((()=>{x(!0),o(!1)})).catch((()=>{g(!0)}))}})]})]})};var os=i(74591),us=i(56408);const ms=({showOnlineIndicator:e})=>(0,U.jsxs)("div",{className:ae,children:[(0,U.jsxs)("div",{className:ne,children:[(0,U.jsx)(us.f,{iconSize:24}),e?(0,U.jsx)("div",{className:re}):null]}),(0,U.jsxs)("div",{className:ce,children:[(0,U.jsx)("div",{className:j()(le,de)}),(0,U.jsx)("div",{className:le}),(0,U.jsx)("div",{className:le})]})]}),fs=()=>(0,U.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:ie,children:[(0,U.jsx)(p.D,{as:"p",className:te,children:r.ag.get("buddy-feed.let-followers-see-your-listening")}),(0,U.jsx)(ms,{showOnlineIndicator:!0}),(0,U.jsx)(ms,{showOnlineIndicator:!0}),(0,U.jsx)(ms,{}),(0,U.jsx)(p.D,{as:"p",className:te,children:r.ag.get("buddy-feed.enable-share-listening-activity")}),(0,U.jsx)(os.rU,{to:"/preferences",className:oe,children:(0,U.jsx)(je.D,{colorSet:"invertedLight",className:ue,children:r.ag.get("desktop.settings.settings")})})]});var gs=i(75353),hs=i(49823);const xs="jUF2eKgYMm64aYykubct",bs="zhL_lhJqzKfJVy7L5VuY",js="XqquM_o2eODcnD8Y4QhS",ps="UGtycHBJ4egymBSmD_lX",ys="ND2ydDPzwQZB7HyaGCN8",Ns="D9YN554UFGJle2CPP1TA",vs="v7Zcy9UKVUTDZIMKB6ZF",ks="RX3U6eAasqazEkuFdnj0",Cs=({children:e,page:s})=>{const i=0===s,t=e.filter(((e,i)=>i!==s));return(0,U.jsx)(gs.Z,{component:null,children:t.map((e=>(0,U.jsx)(hs.Z,{in:i,timeout:500,classNames:{enter:i?xs:ys,enterActive:i?bs:Ns,exit:i?js:vs,exitActive:i?ps:ks},children:e},i?"first-page":"second-page")))})};function Es(e){return e.sort(((e,s)=>s.timestamp-e.timestamp))}function Is(e,s){return s.some((s=>s.user.uri===e.user.uri))?s:Es([...s,e])}function Ss(e,s){return s.filter((s=>s.user.uri!==e))}function ws(e){const s=(0,Pe.I)(),[i,a]=(0,t.useState)(Es(e)),{subscribeToFriend:n,unSubscribeFromFriend:r}=function(e,s){const i=(0,Pe.I)(),a=(0,t.useRef)(e),n=(0,t.useRef)({}),r=(0,t.useRef)(s);r.current=s;const c=(0,t.useCallback)((e=>{const s=(0,y.EC)(e)?.username;return i.subscribeToBuddyActivity(s,(e=>{e&&r.current(e)}))}),[i]),l=(0,t.useCallback)((e=>{n.current[e]?.cancel(),delete n.current[e]}),[]);return(0,t.useEffect)((()=>{n.current=a.current.reduce(((e,s)=>{const i=s.user.uri,t=c(i);return e[i]=t,e}),{})}),[c]),(0,t.useEffect)((()=>{const e=n.current;return()=>{Object.values(e).forEach((e=>{e.cancel()}))}}),[]),{subscribeToFriend:c,unSubscribeFromFriend:l}}(e,(e=>{a((s=>function(e,s){return Es(s.map((s=>s.user.uri===e.user.uri?e:s)))}(e,s)))}));return(0,Se.d)(Ee.rA.OPERATION_COMPLETE,(async e=>{const t=e.data.uris;if(e.data.operation!==Ee.BM.FOLLOW_USER){if(e.data.operation===Ee.BM.UNFOLLOW_USER)for(const e of t)i.find((s=>s.user.uri===e))&&(r(e),a((s=>Ss(e,s))))}else for(const e of t)if(!i.find((s=>s.user.uri===e))){const i=(await s.fetchFriendActivity([e]))[0];a((e=>Is(i,e))),n(e)}})),i}const Ls=({initialFriends:e})=>{const s=(0,u.o)(),i=ws(e),x=(0,h.$P)(),{spec:b}=(0,h.fU)(n.createDesktopFriendActivityEventFactory,{});(0,t.useEffect)((()=>{s({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[s]);const[j,p]=(0,t.useState)(!1),y=()=>{j||x.logInteraction(b.addFriendButtonFactory().hitUiReveal()),p(!j)},N=0===i.length,v=(0,t.useCallback)((()=>{x.logInteraction(b.closeButtonFactory().hitUiHide())}),[x,b]);return(0,U.jsx)(g.DJ.Provider,{value:"buddy_feed",children:(0,U.jsx)(c.l,{label:r.ag.get("buddy-feed.friend-activity"),children:(0,U.jsxs)(Cs,{page:j?1:0,children:[(0,U.jsx)("div",{className:J,children:(0,U.jsx)(ds,{onBackButtonClick:y,feedIsEmpty:N,goToAddFriends:j})}),(0,U.jsx)("div",{className:R,children:(0,U.jsxs)(l.K,{children:[(0,U.jsx)(d.V,{title:r.ag.get("buddy-feed.friend-activity"),panel:o.s.BuddyFeed,onClose:v,actions:(0,U.jsx)(f.ws,{label:r.ag.get("buddy-feed.add-friends"),children:(0,U.jsx)(m.E,{ariaLabel:r.ag.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:y,icon:a.t})})}),(0,U.jsx)("div",{className:ee,children:(0,U.jsx)(m.E,{ariaLabel:r.ag.get("buddy-feed.add-friends"),className:se,size:"sm",onClick:y,icon:a.t})}),N?(0,U.jsx)(fs,{}):(0,U.jsx)(xe,{friends:i,spec:b})]})})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.js.map