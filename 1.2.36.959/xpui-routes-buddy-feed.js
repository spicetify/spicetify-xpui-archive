"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[7564],{97927:(e,s,i)=>{i.r(s),i.d(s,{default:()=>Ls});var a=i(79474),t=i(72506),n=i(89770),r=i(14056),l=i(59560),c=i(88713),d=i(51765),o=i(89063),u=i(46593),m=i(60181),x=i(36471),f=i(42360),h=i(14494),j=i(67302),g=i(23659),b=i(98764),p=i(61080),N=i(27977),y=i(98258),v=i(59841),C=i(99139);let k=function(e){return e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e}({});var S=i(98678),E=i(26013),R=i(10801),w=i(28049);var L=i(97500),T=i.n(L),I=i(23689),O=i(37128),B=i(29969),D=i(26229),_=i(32247);const P="jmX3vUTqdroySvWZjafY",A="sy4ejRXtpCCm2rnVCsBh",F="HO7uMcLeIpPBUBfBUF7f",U="EWRfCzpvY8DGEJrpWuib";var Q=i(13274);const z=({name:e,following:s,imageUrl:i,uri:n})=>{const c=(0,D.f)(),d=(0,x.W)(),o=a.createRef(),[u,m]=(0,a.useState)(s);(0,_.N)(B.mc.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(n))switch(e.data.operation){case B.JK.FOLLOW_USER:m(!0);break;case B.JK.UNFOLLOW_USER:m(!1)}}));const f=(0,a.useCallback)((()=>{u?c.unfollowUsers([n]):(c.followUsers([n]),d({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),o.current&&o.current.blur()}),[u,o,n,c,d]);return(0,a.useEffect)((()=>{m(s)}),[s]),(0,Q.jsxs)("div",{className:P,children:[(0,Q.jsx)(O.e,{label:e,width:40,userIconSize:"small",images:(0,a.useMemo)((()=>[{width:40,height:40,url:i}]),[i])}),(0,Q.jsxs)("div",{className:T()(A,"ellipsis-one-line"),children:[(0,Q.jsx)(b.E,{as:"p",variant:"bodySmallBold",className:"ellipsis-one-line",children:e}),u&&(0,Q.jsx)(b.E,{as:"p",variant:"marginal",className:"ellipsis-one-line",children:r.Ru.get("following")})]}),(0,Q.jsx)("div",{className:F,children:(0,Q.jsx)(l.a,{className:U,size:"sm",ref:o,onClick:f,ariaLabel:u?r.Ru.get("buddy-feed.button.remove-friend"):r.Ru.get("buddy-feed.button.add-friend"),icon:u?I.M:t.k})})]})},M="rnrQ23E2_XN8d7ZBqsTp";function Y({facebookFriends:e}){return(0,Q.jsx)("div",{className:M,children:e.map((({uri:e,following:s,title:i,image:a})=>(0,Q.jsx)(z,{uri:e,name:i,imageUrl:a,following:s},`fb-friend-${e}`)))})}const W="eGd6xxi5CmL4GBZoEnMi";function Z(){return(0,Q.jsx)("div",{className:W,children:Array(20).fill(0).map(((e,s)=>(0,Q.jsx)(R.Y,{isLoading:!0,charCount:100,as:"p",variant:"titleSmall"},s)))})}const H="wFKGrAXEW5REryzTsDIb",G="Na5e2ZRRgwg_8duvoFyo",J="sgUgGj3mSuAdpNv8AyYQ",X="ePqfotL3LdZXKKlsSp1G",V="Jxd3auUMXwsqpPcizfbP",q="KPTOp08r5MTyYMmcTBcM",K="uaVnv8WopjiEsa4Hpl_r",$="eI_jytcKj_NBe3vo5mvx",ee="CxoJJA7kFeXzEeE2R6f7",se=({onBackButtonClick:e})=>{const[s,i]=(0,a.useState)(""),{isLoading:t,friends:n}=(e=>{const s=(0,C.C)(),i=e.trim().toLowerCase(),{data:a,isLoading:t}=(0,w.I)({queryKey:["useFacebookFriends"],queryFn:async()=>(await s.fetchFacebookFriends()).sort(((e,s)=>e.title>s.title?1:-1))});return{isLoading:t,friends:a?.filter((({title:e})=>-1!==e.trim().toLowerCase().indexOf(i)))??[]}})(s),c=(0,S.YQ)((e=>{i(e.target.value)}),100),d=(0,a.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,Q.jsxs)("div",{className:H,children:[(0,Q.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.button.back"),onClick:e,ref:d,className:G,icon:g.g,size:"sm",testId:"back-to-friends"}),(0,Q.jsxs)("div",{className:J,children:[(0,Q.jsx)("div",{className:X,children:(0,Q.jsx)(N.G,{className:V,size:"large"})}),(0,Q.jsx)("div",{className:q,children:t?(0,Q.jsx)(R.Y,{isLoading:!0,charCount:25,as:"p",variant:"bodySmall"}):(0,Q.jsx)(b.E,{as:"p",variant:"bodySmall",children:r.Ru.get("buddy-feed.number-of-friends",n.length)})})]}),t?(0,Q.jsx)(Z,{}):(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsxs)("div",{className:K,children:[(0,Q.jsx)(E.C,{className:ee,size:"small",role:"presentation"}),(0,Q.jsx)("input",{onChange:c,className:$,placeholder:r.Ru.get("buddy-feed.find-in-playlists")})]}),(0,Q.jsx)(Y,{facebookFriends:n})]})]})};var ie=i(45132);function ae({isOpen:e,onClose:s,onConfirm:i}){return(0,Q.jsx)(ie.T,{onClose:s,"aria-label":r.Ru.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:i,titleText:r.Ru.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:r.Ru.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:r.Ru.get("queue.cancel-button"),confirmText:r.Ru.get("web-player.buddy-feed.connect-button"),isOpen:e})}const te="PWrXmnQx41DSpIe1D_nH",ne="AzWuuC6HtstaRZSyCs3n",re="VrSCtYccvuQZG9aY627D",le="mSFjqxw0tzcwc0ZCN1YP",ce="Q9ZfLJTBuMTFz4HsBThH",de="_76MQUYO_OcYkQOL1dlw",oe="TOY_wX6BMTOxtaEcJX2X",ue="A_pGgx3U5jNWUM85mJLQ",me="ffXJrzSIg2CXoGlxDi0v",xe="zmmtwzKSFa5srnl7Ftq2",fe=e=>{const s=(0,x.W)(),{onBackButtonClick:i,feedIsEmpty:t,goToAddFriends:n=!1}=e,c=function(){const e=(0,C.C)(),[s,i]=(0,a.useState)(k.LOADING);return(0,a.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{i(e.connection?k.CONNECTED:k.DISCONNECTED)})).cancel),[e]),s}(),d=(0,C.C)(),[o,u]=(0,a.useState)(!1),[m,f]=(0,a.useState)(!1),[h,j]=(0,a.useState)(!1),S=(0,a.useCallback)((e=>{null!==e&&e.focus()}),[]),E=(0,a.useCallback)((()=>{location.reload()}),[]);if(m)return(0,Q.jsxs)("div",{className:me,children:[(0,Q.jsx)(l.a,{onClick:i,ref:S,className:re,ariaLabel:r.Ru.get("buddy-feed.button.back"),icon:g.g,size:"sm"}),(0,Q.jsxs)("div",{className:xe,children:[(0,Q.jsx)(b.E,{as:"h1",variant:"bodyMediumBold",className:ne,children:r.Ru.get("error-dialog.generic.header")}),(0,Q.jsx)(b.E,{as:"p",variant:"bodySmall",className:le,children:r.Ru.get("error-dialog.generic.body")}),(0,Q.jsx)(p.$,{colorSet:"invertedLight",onClick:E,children:r.Ru.get("error.reload")})]})]});const R=(n||h)&&c===k.CONNECTED;return(0,Q.jsxs)("div",{className:te,children:[R&&(0,Q.jsx)(se,{onBackButtonClick:()=>{t&&j(!1),i()}}),!R&&(0,Q.jsxs)("div",{className:de,children:[(0,Q.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.button.back"),onClick:i,className:re,ref:S,icon:g.g,size:"sm"}),(0,Q.jsx)(b.E,{as:"h1",variant:"bodyMediumBold",className:ne,children:r.Ru.get("buddy-feed.friend-activity")}),(0,Q.jsx)(b.E,{as:"p",variant:"bodySmall",className:le,children:r.Ru.get("buddy-feed.facebook.connect-with-friends-default")}),(0,Q.jsx)("div",{className:oe,children:(0,Q.jsx)(p.$,{className:ue,size:"small",iconLeading:N.G,UNSAFE_colorSet:(0,y.mA)("#2374E1",v.white),onClick:()=>{s({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),c!==k.CONNECTED?u(!0):j(!0)},children:r.Ru.get("buddy-feed.facebook.button")})}),(0,Q.jsx)(b.E,{as:"p",variant:"marginal",className:ce,children:r.Ru.get("buddy-feed.facebook.disclaimer")}),(0,Q.jsx)(ae,{isOpen:o,onClose:()=>{u(!1)},onConfirm:()=>{d.connectToFacebook().then((()=>{j(!0),u(!1)})).catch((()=>{f(!0)}))}})]})]})};var he=i(60096),je=i(43204);const ge="jGcEaPyhr1c_janM2uRF",be="yHlSWaHkqZHm5mcY8ZFh",pe="toPt7VOT_PiDx5Gj3SM2",Ne="xU4sacBisQneHoQeHMP5",ye="srjSlmxMGzXnJBc32BJa",ve="lju7xv10a5Y5Z8h8CcKJ",Ce="jr794VV4i2iUBRhfvS5i",ke="KE3gK5ccLz2gL3dhJ4BW",Se="pO2rsGFqUdaNhpLrif21",Ee="Ydxgl4Y23orfVVVI9O2k",Re="VhqWrkzIrJrvdyj7ZXMd",we="T3liC_3fbMOTilR4HHKD",Le="W_tr6AMQB9Chbc9bCS9w",Te="yDdNxgieZmqjgHQCW3UE",Ie="iRrzzadYGo2MSuVhmVCn",Oe="_8yOZhEqs2xrYtslnNcDw",Be="aikUDGtqRnCX0ZwYHDUW",De="T_HXMW6n5qsbLbPTr1GS",_e="tYswKV9PmtTCv62LOPIV",Pe="GlDNRQ2w0t4h9WBI4GgN",Ae="BQGSV5BvuAaJ5rmFAXLp",Fe="ZLbFjRdp1AMXebZH6UWM",Ue="jhtyHt6d9vbxK6VtCI7a",Qe="oCaGCB13zdReRutfBS8_",ze="MR1n58Qu0kPorQtveOCQ",Me="y10vXronmQ6eYMlJrIp3",Ye=({showOnlineIndicator:e})=>(0,Q.jsxs)("div",{className:_e,children:[(0,Q.jsxs)("div",{className:Pe,children:[(0,Q.jsx)(je.v,{size:"medium"}),e?(0,Q.jsx)("div",{className:Ae}):null]}),(0,Q.jsxs)("div",{className:Fe,children:[(0,Q.jsx)("div",{className:T()(Ue,Qe)}),(0,Q.jsx)("div",{className:Ue}),(0,Q.jsx)("div",{className:Ue})]})]}),We=()=>(0,Q.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:Be,children:[(0,Q.jsx)(b.E,{as:"p",className:De,children:r.Ru.get("buddy-feed.let-followers-see-your-listening")}),(0,Q.jsx)(Ye,{showOnlineIndicator:!0}),(0,Q.jsx)(Ye,{showOnlineIndicator:!0}),(0,Q.jsx)(Ye,{}),(0,Q.jsx)(b.E,{as:"p",className:De,children:r.Ru.get("buddy-feed.enable-share-listening-activity")}),(0,Q.jsx)(he.N_,{to:"/preferences",className:ze,children:(0,Q.jsx)(p.$,{colorSet:"invertedLight",className:Me,children:r.Ru.get("desktop.settings.settings")})})]});var Ze=i(77173),He=i(50042),Ge=i(57480),Je=i(40091),Xe=i(83856),Ve=i(88291),qe=i(84387),Ke=i(59416),$e=i(35663),es=i(63445),ss=i(41955),is=i(98496),as=i(32371),ts=i(54745),ns=i(2092),rs=i(8955),ls=i(95999),cs=i(26271),ds=i(9440),os=i(64463),us=i(45916);const ms=e=>{const{timestamp:s,isNowPlaying:i}=e;return i?(0,Q.jsx)(c.Zp,{label:r.Ru.get("time.now"),children:(0,Q.jsx)(os.A,{"aria-label":r.Ru.get("time.now"),size:"small"})}):(0,Q.jsx)("span",{children:(0,us.Z)(s)})},xs=e=>Date.now()-e<9e5,fs=(e,s)=>{const i=(0,Xe.o_)(e)?.type;switch(i){case Xe.NQ.PLAYLIST:case Xe.NQ.PLAYLIST_V2:return(0,Q.jsx)($e.W,{uri:e});case Xe.NQ.EPISODE:case Xe.NQ.SHOW:return(0,Q.jsx)(es.H,{uri:e});case Xe.NQ.ALBUM:return(0,Q.jsx)(qe.h,{uri:e,artistUri:s});case Xe.NQ.ARTIST:return(0,Q.jsx)(Ke.t,{uri:e});default:return null}},hs=e=>{switch(e){case Xe.NQ.ALBUM:return ds.c.ALBUM;case Xe.NQ.ARTIST:return ds.c.ARTIST;case Xe.NQ.SHOW:return ds.c.SHOW;case Xe.NQ.EPISODE:return ds.c.EPISODE;case Xe.NQ.PLAYLIST:case Xe.NQ.PLAYLIST_V2:return ds.c.PLAYLIST;default:return}},js=e=>{const{show:s=!0,spec:i,friend:t}=e,n=(0,a.useMemo)((()=>t.user.imageUrl?[{url:t.user.imageUrl,width:0,height:0}]:[]),[t.user.imageUrl]),l=(0,x.W)(),c=(0,h.s)(),d=t.track,o=d.uri,{togglePlay:u,isPlaying:m,isActive:f}=(0,cs.P)({uri:o},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),j=(0,Xe.o_)(d.context?.uri),g=j?.type,p=(0,a.useCallback)((()=>{u(),l({intent:m?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:o});const e=i.friendRowFactory().playButtonFactory();f?m?c.logInteraction(e.hitPause({itemToBePaused:o})):c.logInteraction(e.hitResume({itemToBeResumed:o})):c.logInteraction(e.hitPlay({itemToBePlayed:o}))}),[l,m,o,i,f,u,c]),N=(0,a.useCallback)(((e,s)=>{c.logInteraction(i.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:s}))}),[c,i]),{draggable:y,onDragStart:v}=(0,ns.P)({itemUris:[o],dragLabelText:d.name}),{draggable:C,onDragStart:k}=(0,ns.P)({itemUris:[d.artist?.uri],dragLabelText:d.artist?.name}),{draggable:S,onDragStart:E}=(0,ns.P)({itemUris:[d.context?.uri],dragLabelText:d.context?.name});return s?(0,Q.jsxs)("div",{className:T()(ge),children:[(0,Q.jsx)(Ve.h,{menu:fs(d.context?.uri,d.artist?.uri),children:(0,Q.jsxs)("div",{className:Ne,children:[(0,Q.jsx)(O.e,{label:t.user.name,width:40,userIconSize:"small",images:n,withBadge:xs(t.timestamp)}),(0,Q.jsx)(ts.x,{className:ye,iconClassName:ve,isPlaying:m,isLocked:!1,onClick:p,playAriaLabel:m?r.Ru.get("pause"):`${r.Ru.get("play")} ${d.artist.name} ${d.name}`})]})}),(0,Q.jsxs)("div",{className:T()(Ce),children:[(0,Q.jsxs)("div",{className:ke,children:[(0,Q.jsx)(b.E,{as:"p",variant:"bodySmallBold",className:T()(Se,"ellipsis-one-line"),children:(0,Q.jsx)(ls.pZ,{value:"/buddyfeed_user_profile",children:(0,Q.jsx)(Ve.h,{menu:(0,Q.jsx)(is.B,{uri:t.user.uri}),children:(0,Q.jsx)(as.Link,{title:t.user.name,to:t.user.uri,dir:"auto",onClick:()=>N("profile_link",t.user.uri),children:t.user.name})})})}),(0,Q.jsx)(b.E,{as:"p",variant:"marginal",className:T()(Ee),children:(0,Q.jsx)(ms,{timestamp:t.timestamp,isNowPlaying:xs(t.timestamp)})})]}),(0,Q.jsxs)(b.E,{as:"p",variant:"marginal",className:Re,children:[(0,Q.jsx)(ls.pZ,{value:"/buddyfeed_track",children:(0,Q.jsx)(Ve.h,{menu:(0,Q.jsx)(ss.P,{uri:d.uri,contextUri:d.context?.uri,albumUri:d.album?.uri,artists:[d.artist]}),children:(0,Q.jsx)(as.Link,{title:d.name,to:o,className:"ellipsis-one-line",dir:"auto",draggable:y,onDragStart:v,onClick:()=>N("track_link",o),children:d.name})})}),(0,Q.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,Q.jsx)(ls.pZ,{value:"/buddyfeed_artist",children:(0,Q.jsx)(Ve.h,{menu:d.artist?(0,Q.jsx)(Ke.t,{uri:d.artist.uri}):null,children:(0,Q.jsx)(as.Link,{title:d.artist?.name,to:d.artist?.uri,className:"ellipsis-one-line",dir:"auto",draggable:C,onDragStart:k,onClick:()=>N("artist_link",d.artist?.uri),children:d.artist?.name})})})]}),(0,Q.jsx)(b.E,{as:"p",variant:"marginal",className:T()("ellipsis-one-line",Le),children:(0,Q.jsx)(ls.pZ,{value:"/buddyfeed_context",children:(0,Q.jsx)(Ve.h,{menu:fs(d.context?.uri,d.artist?.uri),children:(0,Q.jsxs)(as.Link,{title:d.context?.name,to:d.context?.uri,className:Te,draggable:S,onDragStart:E,onClick:()=>N("context_link",d.context?.uri),children:[(0,Q.jsx)(rs.s,{type:hs(g),iconSize:16,className:we}),(0,Q.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:d.context?.name})]})})})})]})]},t.user.uri):null};function gs({friends:e,spec:s}){const{currentSession:i}=(0,He.D)(),a=(0,Je.y)(),t=!i?.active&&a&&(0,Q.jsx)("li",{children:(0,Q.jsx)(Ge.p,{localStorageKey:"dismissStartJamButtonFromFriendFeed"})},"start-jam-button");return(0,Q.jsx)(Ze.ZI,{flipKey:e.map((e=>e.user.uri)).join(""),children:(0,Q.jsxs)("ul",{children:[t,e.map(((e,i)=>(0,Q.jsx)(Ze.lf,{flipId:e.user.uri,children:(0,Q.jsx)("li",{children:(0,Q.jsx)(js,{friend:e,show:i<100,spec:s},e.user.uri)})},e.user.uri)))]})})}var bs=i(66535),ps=i(29439);const Ns="VTOHA2pQ5UOAQhut6swb",ys="y02ezh9Bcfm_61XcxvOS",vs="rb6j61g6Avhg8RARvz3b",Cs="xDW2awz1Oc3Khs6Wsn8g",ks="MOKoNTiYkc9jh0xhfoZH",Ss="gOHEpGu2st4QQtJy8OPw",Es="ijngDXlnRFRYySzwV5JJ",Rs="oNiqjPtyJeYH6LqZlnVa",ws=({children:e,page:s})=>{const i=0===s,a=e.filter(((e,i)=>i!==s));return(0,Q.jsx)(bs.A,{component:null,children:a.map((e=>(0,Q.jsx)(ps.A,{in:i,timeout:500,classNames:{enter:i?Ns:ks,enterActive:i?ys:Ss,exit:i?vs:Es,exitActive:i?Cs:Rs},children:e},i?"first-page":"second-page")))})},Ls=({friends:e})=>{const s=(0,x.W)(),i=(0,h.s)(),{spec:g}=(0,j.r)(n.W,{});(0,a.useEffect)((()=>{s({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[s]),(0,a.useEffect)((()=>{i.logImpression(g.impression())}),[i,g]);const[b,p]=(0,a.useState)(!1),N=()=>{b||i.logInteraction(g.addFriendButtonFactory().hitUiReveal()),p(!b)},y=0===e.length,v=(0,a.useCallback)((()=>{i.logInteraction(g.closeButtonFactory().hitUiHide())}),[i,g]);return(0,Q.jsx)(f.ql.Provider,{value:"buddy_feed",children:(0,Q.jsx)(d._,{label:r.Ru.get("buddy-feed.friend-activity"),focusTransferId:"BUDDY-FEED",children:(0,Q.jsxs)(ws,{page:b?1:0,children:[(0,Q.jsx)("div",{className:be,children:(0,Q.jsx)(fe,{onBackButtonClick:N,feedIsEmpty:y,goToAddFriends:b})}),(0,Q.jsx)("div",{className:pe,children:(0,Q.jsxs)(o.w,{children:[(0,Q.jsx)(u.a,{title:r.Ru.get("buddy-feed.friend-activity"),panel:m.Z.BuddyFeed,onClose:v,actions:(0,Q.jsx)(c.Zp,{label:r.Ru.get("buddy-feed.add-friends"),children:(0,Q.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:N,icon:t.k})})}),(0,Q.jsx)("div",{className:Ie,children:(0,Q.jsx)(l.a,{ariaLabel:r.Ru.get("buddy-feed.add-friends"),className:Oe,size:"sm",onClick:N,icon:t.k})}),y?(0,Q.jsx)(We,{}):(0,Q.jsx)(gs,{friends:e,spec:g})]})})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.js.map