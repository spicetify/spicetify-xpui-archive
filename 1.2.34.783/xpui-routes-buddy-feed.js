"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[7564],{21114:(e,s,a)=>{a.r(s),a.d(s,{default:()=>Ss});var i=a(79474),t=a(21518),n=a(50696),l=a(37298),r=a(52224),c=a(84245),d=a(81482),o=a(20762),u=a(33040),m=a(51603),f=a(65948),x=a(5549),h=a(39974),g=a(15486),b=(a(1137),a(77173)),j=a(97500),N=a.n(j),y=a(43029),p=a(48762),k=a(94400),v=a(41627),C=a(86778),E=a(25668),S=a(31995),I=a(53098),L=a(75450),w=a(33861),R=a(35195),T=a(91484),O=a(59866),A=a(64739),D=a(39431),U=a(13031),B=a(23e3),_=a(41155),P=a(50164),F=a(13274);const z=e=>{const{timestamp:s,isNowPlaying:a}=e;return a?(0,F.jsx)(c.Zp,{label:l.R.get("time.now"),children:(0,F.jsx)(_.A,{"aria-label":l.R.get("time.now"),size:"small"})}):(0,F.jsx)("span",{children:(0,P.Z)(s)})},Z="gj9SOnCIzruGWAM5m3XO",M="VLKqDIGaQn2bILzJKSZ0",Q="oWQvtc5QZlmB60A9ejJx",Y="dLg5WMgjh1kfYtZ_MnZz",K="VBQoaks4ZkfIknTKmxXZ",W="Irsd58UNEmDPxdhXKXCs",H="_Xe25F2aC59Kljgqyw3G",q="P7j2kCLc27vLybuzy5XB",J="ktMuChpoidaEvECE7y8f",G="LywlKLgNaEtHZzLM3EX5",V="mthrc5U9wb8F4zMBqlPy",X="dvb9y9hcP8sUfMhUASKO",$="kE5DI3BkNlo9zuO7K3aO",ee="hnEmEncF7kB2TnE_Uyja",se="j7K7_Zly3G1HS9MlKoao",ae="gY0qK1gmEdhq5idwQc8C",ie="MObmOrMxbQpO10ebAtZA",te="cBPbfBWIIPDzhIT6i3ih",ne="PjDcsgAPmXlcTBJRGpIu",le="IRpPQFA57qgQ5jicWWaD",re="Hm3nIbegLclY1uCAmnx_",ce="bhRoVUHjWdo9mgUkU6fe",de="BliqfY7vu_qE2C9zs5Ou",oe="qdYWuHZd4HdSWfd4pSQB",ue="DhvYWKjDc7uyF3HfkDJJ",me="ralK8s_OmE8a8zWcfNKM",fe=e=>Date.now()-e<9e5,xe=(e,s)=>{const a=(0,p.o_)(e)?.type;switch(a){case p.NQ.PLAYLIST:case p.NQ.PLAYLIST_V2:return(0,F.jsx)(S.W,{uri:e});case p.NQ.EPISODE:case p.NQ.SHOW:return(0,F.jsx)(I.H,{uri:e});case p.NQ.ALBUM:return(0,F.jsx)(C.h,{uri:e,artistUri:s});case p.NQ.ARTIST:return(0,F.jsx)(E.t,{uri:e});default:return null}},he=e=>{switch(e){case p.NQ.ALBUM:return B.c.ALBUM;case p.NQ.ARTIST:return B.c.ARTIST;case p.NQ.SHOW:return B.c.SHOW;case p.NQ.EPISODE:return B.c.EPISODE;case p.NQ.PLAYLIST:case p.NQ.PLAYLIST_V2:return B.c.PLAYLIST;default:return}},ge=e=>{const{show:s=!0,spec:a,friend:t}=e,n=(0,i.useMemo)((()=>t.user.imageUrl?[{url:t.user.imageUrl,width:0,height:0}]:[]),[t.user.imageUrl]),r=(0,f.W)(),c=(0,h.s)(),d=t.track,o=d.uri,{togglePlay:u,isPlaying:m,isActive:x}=(0,U.P)({uri:o},{featureIdentifier:"buddy_feed",referrerIdentifier:"buddy_feed"}),g=(0,p.o_)(d.context?.uri),b=g?.type,j=(0,i.useCallback)((()=>{u(),r({intent:m?"pause":"play",type:"click",itemIdSuffix:"buddyfeed_play",targetUri:o});const e=a.friendRowFactory().playButtonFactory();x?m?c.logInteraction(e.hitPause({itemToBePaused:o})):c.logInteraction(e.hitResume({itemToBeResumed:o})):c.logInteraction(e.hitPlay({itemToBePlayed:o}))}),[r,m,o,a,x,u,c]),C=(0,i.useCallback)(((e,s)=>{c.logInteraction(a.friendRowFactory().friendRowLinkFactory({identifier:e}).hitUiNavigate({destination:s}))}),[c,a]),{draggable:S,onDragStart:I}=(0,O.P)({itemUris:[o],dragLabelText:d.name}),{draggable:B,onDragStart:_}=(0,O.P)({itemUris:[d.artist?.uri],dragLabelText:d.artist?.name}),{draggable:P,onDragStart:M}=(0,O.P)({itemUris:[d.context?.uri],dragLabelText:d.context?.name});return s?(0,F.jsxs)("div",{className:N()(Z),children:[(0,F.jsx)(v.h,{menu:xe(d.context?.uri,d.artist?.uri),children:(0,F.jsxs)("div",{className:Y,children:[(0,F.jsx)(k.e,{label:t.user.name,width:40,userIconSize:"small",images:n,withBadge:fe(t.timestamp)}),(0,F.jsx)(T.x,{className:K,iconClassName:W,isPlaying:m,isLocked:!1,onClick:j,playAriaLabel:m?l.R.get("pause"):`${l.R.get("play")} ${d.artist.name} ${d.name}`})]})}),(0,F.jsxs)("div",{className:N()(H),children:[(0,F.jsxs)("div",{className:q,children:[(0,F.jsx)(y.E,{as:"p",variant:"bodySmallBold",className:N()(J,"ellipsis-one-line"),children:(0,F.jsx)(D.pZ,{value:"/buddyfeed_user_profile",children:(0,F.jsx)(v.h,{menu:(0,F.jsx)(w.B,{uri:t.user.uri}),children:(0,F.jsx)(R.Link,{title:t.user.name,to:t.user.uri,dir:"auto",onClick:()=>C("profile_link",t.user.uri),children:t.user.name})})})}),(0,F.jsx)(y.E,{as:"p",variant:"marginal",className:N()(G),children:(0,F.jsx)(z,{timestamp:t.timestamp,isNowPlaying:fe(t.timestamp)})})]}),(0,F.jsxs)(y.E,{as:"p",variant:"marginal",className:V,children:[(0,F.jsx)(D.pZ,{value:"/buddyfeed_track",children:(0,F.jsx)(v.h,{menu:(0,F.jsx)(L.P,{uri:d.uri,contextUri:d.context?.uri,albumUri:d.album?.uri,artists:[d.artist]}),children:(0,F.jsx)(R.Link,{title:d.name,to:o,className:"ellipsis-one-line",dir:"auto",draggable:S,onDragStart:I,onClick:()=>C("track_link",o),children:d.name})})}),(0,F.jsx)("span",{"aria-hidden":!0,children:" • "}),(0,F.jsx)(D.pZ,{value:"/buddyfeed_artist",children:(0,F.jsx)(v.h,{menu:d.artist?(0,F.jsx)(E.t,{uri:d.artist.uri}):null,children:(0,F.jsx)(R.Link,{title:d.artist?.name,to:d.artist?.uri,className:"ellipsis-one-line",dir:"auto",draggable:B,onDragStart:_,onClick:()=>C("artist_link",d.artist?.uri),children:d.artist?.name})})})]}),(0,F.jsx)(y.E,{as:"p",variant:"marginal",className:N()("ellipsis-one-line",$),children:(0,F.jsx)(D.pZ,{value:"/buddyfeed_context",children:(0,F.jsx)(v.h,{menu:xe(d.context?.uri,d.artist?.uri),children:(0,F.jsxs)(R.Link,{title:d.context?.name,to:d.context?.uri,className:ee,draggable:P,onDragStart:M,onClick:()=>C("context_link",d.context?.uri),children:[(0,F.jsx)(A.s,{type:he(b),iconSize:16,className:X}),(0,F.jsx)("span",{dir:"auto",className:"ellipsis-one-line",children:d.context?.name})]})})})})]})]},t.user.uri):null};function be({friends:e,spec:s}){return(0,F.jsx)(b.ZI,{flipKey:e.map((e=>e.user.uri)).join(""),children:(0,F.jsx)("ol",{children:e.map(((e,a)=>(0,F.jsx)(b.lf,{flipId:e.user.uri,children:(0,F.jsx)("li",{children:(0,F.jsx)(ge,{friend:e,show:a<100,spec:s},e.user.uri)})},e.user.uri)))})})}var je=a(31927),Ne=a(12793),ye=a(22509),pe=a(33037),ke=a(4118),ve=(a(62355),a(48117),a(98678)),Ce=a(11353),Ee=a(62725),Se=a(52809),Ie=a(81517),Le=a(67007);const we="w5nHQ74JGTytKwWanjvB",Re="u11kJflcqt7CSXo9qL_T",Te="MmENkh6tW0MyjTtTtPHZ",Oe="Gl0dkNQbAyNjVZ1IpghI",Ae=({name:e,following:s,imageUrl:a,uri:n})=>{const c=(0,Ie.f)(),d=(0,f.W)(),o=i.createRef(),[u,m]=(0,i.useState)(s);(0,Le.N)(Se.mc.OPERATION_COMPLETE,(e=>{if(e.data.uris.includes(n))switch(e.data.operation){case Se.JK.FOLLOW_USER:m(!0);break;case Se.JK.UNFOLLOW_USER:m(!1)}}));const x=(0,i.useCallback)((()=>{u?c.unfollowUsers([n]):(c.followUsers([n]),d({intent:"follow",type:"click",itemIdSuffix:"buddyfeed"})),o.current&&o.current.blur()}),[u,o,n,c,d]);return(0,i.useEffect)((()=>{m(s)}),[s]),(0,F.jsxs)("div",{className:we,children:[(0,F.jsx)(k.e,{label:e,width:40,userIconSize:"small",images:(0,i.useMemo)((()=>[{width:40,height:40,url:a}]),[a])}),(0,F.jsxs)("div",{className:N()(Re,"ellipsis-one-line"),children:[(0,F.jsx)(y.E,{as:"p",variant:"bodySmallBold",className:"ellipsis-one-line",children:e}),u&&(0,F.jsx)(y.E,{as:"p",variant:"marginal",className:"ellipsis-one-line",children:l.R.get("following")})]}),(0,F.jsx)("div",{className:Te,children:(0,F.jsx)(r.a,{className:Oe,size:"sm",ref:o,onClick:x,ariaLabel:u?l.R.get("buddy-feed.button.remove-friend"):l.R.get("buddy-feed.button.add-friend"),icon:u?Ee.M:t.k})})]})},De="nGInMrf62TCFD9MBnEzz";function Ue({facebookFriends:e}){return(0,F.jsx)("div",{className:De,children:e.map((({uri:e,following:s,title:a,image:i})=>(0,F.jsx)(Ae,{uri:e,name:a,imageUrl:i,following:s},`fb-friend-${e}`)))})}var Be=a(56046);const _e="n6rSk6R7nfmSGSgTRR5_";function Pe(){return(0,F.jsx)("div",{className:_e,children:Array(20).fill(0).map(((e,s)=>(0,F.jsx)(Be.Y,{isLoading:!0,charCount:100,as:"p",variant:"titleSmall"},s)))})}var Fe=a(49036),ze=a(54667);const Ze="pZFwflwH1vXVCmAO5vbz",Me="yPL55nV5rC97vJhAf7ke",Qe="qpgo9DQ9rVZbO5pLJog5",Ye="A3hvkJOGkBNa6zWj6oZa",Ke="pIyez6N1SF3jW0U5VUx4",We="lIxuZR4lYTrEKkMYedty",He="VEmC3OHK3uAasHvO5OuA",qe="wzGPtuvvLpOpY1PDu4Qv",Je="YoJTUV4hazVCFNbfKoNq",Ge=({onBackButtonClick:e})=>{const[s,a]=(0,i.useState)(""),{isLoading:t,friends:n}=(e=>{const s=(0,ze.C)(),a=e.trim().toLowerCase(),{data:i,isLoading:t}=(0,Fe.I)({queryKey:["useFacebookFriends"],queryFn:async()=>(await s.fetchFacebookFriends()).sort(((e,s)=>e.title>s.title?1:-1))});return{isLoading:t,friends:i?.filter((({title:e})=>-1!==e.trim().toLowerCase().indexOf(a)))??[]}})(s),c=(0,ve.YQ)((e=>{a(e.target.value)}),100),d=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]);return(0,F.jsxs)("div",{className:Ze,children:[(0,F.jsx)(r.a,{ariaLabel:l.R.get("buddy-feed.button.back"),onClick:e,ref:d,className:Me,icon:je.g,size:"sm",testId:"back-to-friends"}),(0,F.jsxs)("div",{className:Qe,children:[(0,F.jsx)("div",{className:Ye,children:(0,F.jsx)(ye.G,{className:Ke,size:"large"})}),(0,F.jsx)("div",{className:We,children:t?(0,F.jsx)(Be.Y,{isLoading:!0,charCount:25,as:"p",variant:"bodySmall"}):(0,F.jsx)(y.E,{as:"p",variant:"bodySmall",children:l.R.get("buddy-feed.number-of-friends",n.length)})})]}),t?(0,F.jsx)(Pe,{}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)("div",{className:He,children:[(0,F.jsx)(Ce.C,{className:Je,size:"small",role:"presentation"}),(0,F.jsx)("input",{onChange:c,className:qe,placeholder:l.R.get("buddy-feed.find-in-playlists")})]}),(0,F.jsx)(Ue,{facebookFriends:n})]})]})};var Ve=a(73248);function Xe({isOpen:e,onClose:s,onConfirm:a}){return(0,F.jsx)(Ve.T,{onClose:s,"aria-label":l.R.get("web-player.buddy-feed.connect-with-facebook-title"),onConfirm:a,titleText:l.R.get("web-player.buddy-feed.connect-with-facebook-title"),descriptionText:l.R.get("web-player.buddy-feed.connect-with-facebook-description"),cancelText:l.R.get("queue.cancel-button"),confirmText:l.R.get("web-player.buddy-feed.connect-button"),isOpen:e})}let $e=function(e){return e[e.LOADING=0]="LOADING",e[e.CONNECTED=1]="CONNECTED",e[e.DISCONNECTED=2]="DISCONNECTED",e}({});const es="EmZCbU1_B_J9RAHebolL",ss="Ym6Yyx83U7mNKOMw9dxw",as="NXcZaSipzomJ6d4_nM94",is="b9rqRkvRvhrSY4FYHQVC",ts="xHc_2FQr3NxfCgfDSVhY",ns="QAJYN0xWh3h2A5d8_C1g",ls="PKhH1CknobkjJdVITsb4",rs="HgRmCE3NxfiYNtv6pF3H",cs="HnA5mipUMkheAlbxqCn_",ds="mvp0xhvZTo0xv0TIwi9u",os=e=>{const s=(0,f.W)(),{onBackButtonClick:a,feedIsEmpty:t,goToAddFriends:n=!1}=e,c=function(){const e=(0,ze.C)(),[s,a]=(0,i.useState)($e.LOADING);return(0,i.useEffect)((()=>e.subscribeToFacebookConnectionState((e=>{a(e.connection?$e.CONNECTED:$e.DISCONNECTED)})).cancel),[e]),s}(),d=(0,ze.C)(),[o,u]=(0,i.useState)(!1),[m,x]=(0,i.useState)(!1),[h,g]=(0,i.useState)(!1),b=(0,i.useCallback)((e=>{null!==e&&e.focus()}),[]),j=(0,i.useCallback)((()=>{location.reload()}),[]);if(m)return(0,F.jsxs)("div",{className:cs,children:[(0,F.jsx)(r.a,{onClick:a,ref:b,className:as,ariaLabel:l.R.get("buddy-feed.button.back"),icon:je.g,size:"sm"}),(0,F.jsxs)("div",{className:ds,children:[(0,F.jsx)(y.E,{as:"h1",variant:"bodyMediumBold",className:ss,children:l.R.get("error-dialog.generic.header")}),(0,F.jsx)(y.E,{as:"p",variant:"bodySmall",className:is,children:l.R.get("error-dialog.generic.body")}),(0,F.jsx)(Ne.$,{colorSet:"invertedLight",onClick:j,children:l.R.get("error.reload")})]})]});const N=(n||h)&&c===$e.CONNECTED;return(0,F.jsxs)("div",{className:es,children:[N&&(0,F.jsx)(Ge,{onBackButtonClick:()=>{t&&g(!1),a()}}),!N&&(0,F.jsxs)("div",{className:ns,children:[(0,F.jsx)(r.a,{ariaLabel:l.R.get("buddy-feed.button.back"),onClick:a,className:as,ref:b,icon:je.g,size:"sm"}),(0,F.jsx)(y.E,{as:"h1",variant:"bodyMediumBold",className:ss,children:l.R.get("buddy-feed.friend-activity")}),(0,F.jsx)(y.E,{as:"p",variant:"bodySmall",className:is,children:l.R.get("buddy-feed.facebook.connect-with-friends-default")}),(0,F.jsx)("div",{className:ls,children:(0,F.jsx)(Ne.$,{className:rs,size:"small",iconLeading:ye.G,UNSAFE_colorSet:(0,pe.mA)("#2374E1",ke.ONy),onClick:()=>{s({intent:"connect-to-facebook",type:"click",itemIdSuffix:"buddyfeed"}),c!==$e.CONNECTED?u(!0):g(!0)},children:l.R.get("buddy-feed.facebook.button")})}),(0,F.jsx)(y.E,{as:"p",variant:"marginal",className:ts,children:l.R.get("buddy-feed.facebook.disclaimer")}),(0,F.jsx)(Xe,{isOpen:o,onClose:()=>{u(!1)},onConfirm:()=>{d.connectToFacebook().then((()=>{g(!0),u(!1)})).catch((()=>{x(!0)}))}})]})]})};var us=a(48581),ms=a(47992);const fs=({showOnlineIndicator:e})=>(0,F.jsxs)("div",{className:ne,children:[(0,F.jsxs)("div",{className:le,children:[(0,F.jsx)(ms.v,{size:"medium"}),e?(0,F.jsx)("div",{className:re}):null]}),(0,F.jsxs)("div",{className:ce,children:[(0,F.jsx)("div",{className:N()(de,oe)}),(0,F.jsx)("div",{className:de}),(0,F.jsx)("div",{className:de})]})]}),xs=()=>(0,F.jsxs)("div",{"data-testid":"buddy-feed-empty-state",className:ie,children:[(0,F.jsx)(y.E,{as:"p",className:te,children:l.R.get("buddy-feed.let-followers-see-your-listening")}),(0,F.jsx)(fs,{showOnlineIndicator:!0}),(0,F.jsx)(fs,{showOnlineIndicator:!0}),(0,F.jsx)(fs,{}),(0,F.jsx)(y.E,{as:"p",className:te,children:l.R.get("buddy-feed.enable-share-listening-activity")}),(0,F.jsx)(us.N_,{to:"/preferences",className:ue,children:(0,F.jsx)(Ne.$,{colorSet:"invertedLight",className:me,children:l.R.get("desktop.settings.settings")})})]});var hs=a(66535),gs=a(29439);const bs="jUF2eKgYMm64aYykubct",js="zhL_lhJqzKfJVy7L5VuY",Ns="XqquM_o2eODcnD8Y4QhS",ys="UGtycHBJ4egymBSmD_lX",ps="ND2ydDPzwQZB7HyaGCN8",ks="D9YN554UFGJle2CPP1TA",vs="v7Zcy9UKVUTDZIMKB6ZF",Cs="RX3U6eAasqazEkuFdnj0",Es=({children:e,page:s})=>{const a=0===s,i=e.filter(((e,a)=>a!==s));return(0,F.jsx)(hs.A,{component:null,children:i.map((e=>(0,F.jsx)(gs.A,{in:a,timeout:500,classNames:{enter:a?bs:ps,enterActive:a?js:ks,exit:a?Ns:vs,exitActive:a?ys:Cs},children:e},a?"first-page":"second-page")))})},Ss=({friends:e})=>{const s=(0,f.W)(),a=(0,h.s)(),{spec:b}=(0,g.r)(n.W,{});(0,i.useEffect)((()=>{s({intent:"view",type:"impression",itemIdSuffix:"buddyfeed"})}),[s]),(0,i.useEffect)((()=>{a.logImpression(b.impression())}),[a,b]);const[j,N]=(0,i.useState)(!1),y=()=>{j||a.logInteraction(b.addFriendButtonFactory().hitUiReveal()),N(!j)},p=0===e.length,k=(0,i.useCallback)((()=>{a.logInteraction(b.closeButtonFactory().hitUiHide())}),[a,b]);return(0,F.jsx)(x.ql.Provider,{value:"buddy_feed",children:(0,F.jsx)(d._,{label:l.R.get("buddy-feed.friend-activity"),children:(0,F.jsxs)(Es,{page:j?1:0,children:[(0,F.jsx)("div",{className:M,children:(0,F.jsx)(os,{onBackButtonClick:y,feedIsEmpty:p,goToAddFriends:j})}),(0,F.jsx)("div",{className:Q,children:(0,F.jsxs)(o.w,{children:[(0,F.jsx)(u.a,{title:l.R.get("buddy-feed.friend-activity"),panel:m.Z.BuddyFeed,onClose:k,actions:(0,F.jsx)(c.Zp,{label:l.R.get("buddy-feed.add-friends"),children:(0,F.jsx)(r.a,{ariaLabel:l.R.get("buddy-feed.add-friends"),testId:"add-friends-button",size:"sm",onClick:y,icon:t.k})})}),(0,F.jsx)("div",{className:se,children:(0,F.jsx)(r.a,{ariaLabel:l.R.get("buddy-feed.add-friends"),className:ae,size:"sm",onClick:y,icon:t.k})}),p?(0,F.jsx)(xs,{}):(0,F.jsx)(be,{friends:e,spec:b})]})})]})})})}}}]);
//# sourceMappingURL=xpui-routes-buddy-feed.js.map