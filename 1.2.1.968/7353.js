"use strict";(("undefined"!=typeof self?self:global).webpackChunkclient_web=("undefined"!=typeof self?self:global).webpackChunkclient_web||[]).push([[7353],{57353:(e,t,n)=>{n.r(t),n.d(t,{default:()=>we});var a=n(59496),i=n(77646),s=n(46439),r=n(88585),l=n.n(r),o=n(94456),c=n(75930),d=n(1740),u=n(25620),m=n(89349),h=n(92656),g=n(9178),x=n(12739),y=n(58754),p=n(33354),f=n(57354),b=n(79447),I=n(66691),j=n(87452),R=n(84862),v=n(56973),k=n(73305),C=n(34604),P=n(99162),w=n(43001),E=n(20413),T=n(42765),U=n(74284),A=n(22957);var S=n(79396),B=n(3102),F=n(40239);var _=n(58454),N=n(69957),D=n(1686),L=n(81892),M=n(67779),O=n(26712),z=n(91328),$=n(46997),K=n(93324),X=n(16976),Z=n(63743),V=n(78127),H=n(98348),Q=n(2220),G=n(34895),J=n(62652),W=n(99975),Y=n(25431),q=n(20156),ee=n(12883),te=n(24771),ne=n(7678),ae=n(97068),ie=n(6090),se=n(34309),re=n(2079),le=n(84875),oe=n.n(le),ce=n(78410);const de="TRDgmejiOzKjissuLFSx";var ue=n(4637);const me=({onClick:e=(()=>{}),className:t,label:n,ariaLabel:a=n,Icon:i})=>(0,ue.jsx)(ce._,{label:n,children:(0,ue.jsx)("button",{type:"button","aria-label":a,className:oe()(de,t),onClick:e,children:(0,ue.jsx)(i,{iconSize:16})})}),he=a.memo((function({uri:e,uid:t,name:n,durationMs:a,artists:i,album:s,isMOGEFRestricted:r,isExplicit:o,isPlayable:c,index:u,playIndex:m=null,imgUrl:h,contextUri:g,usePlayContextItem:x,isEnhanced:y,playContextPageIndex:p,isFirstRecommendation:f,add:b,remove:I,canBeRemovedFromPlaylist:j,addedBy:R,addedAt:v}){const k=(0,ae._)(e),P=(0,se.k)(e,c),{badges:w,hasBadges:E}=(0,ie.r)({downloadAvailability:k,isExplicit:o,isMOGEFRestricted:r,isEnhanced:y}),T=u+1,U=i.items.map((e=>({uri:e.uri,name:e.profile.name}))),A=(0,ue.jsx)(Q.$,{uri:e,uid:t,albumUri:s?.uri,artists:U,contextUri:g,isRecommendation:y,removePlaylistItems:()=>I([t]),removeRecommendation:()=>I([t]),addRecommendation:()=>b(t),canBeRemovedFromPlaylist:j}),S=U?.map((e=>e.name)).join(d.ag.getSeparator())||"",{isActive:B,isPlaying:F,triggerPlay:_,togglePlay:N}=x({uid:t,uri:e,index:m??u,pageIndex:p}),{spec:L,logger:M}=(0,C.fU)(D.createDesktopTrackListRowEventFactory,{data:{position:u,reason:"",uri:e}}),O=(0,ue.jsx)(me,{onClick:()=>{b(t),M.logInteraction(L.addRecommendationButtonFactory().hitAddToPlaylist({playlist:g,itemToBeAdded:e}))},label:d.ag.get("web-player.enhance.button_label_keep_in_playlist"),Icon:Z.G});return(0,ue.jsx)($.ZP,{value:"row",index:u,children:(0,ue.jsx)(q._P,{menu:A,children:(0,ue.jsxs)(Y.c,{uri:e,contextUri:g,index:u,onTriggerPlay:(e,t)=>{_({loggingParams:t})},isActive:B,ariaRowIndex:u+1,isPlayable:P,ageRestricted:r,dragMetadata:{name:n,createdBy:S},spec:L,removePlaylistItems:e=>I(e.map((e=>e.id))),children:[(0,ue.jsx)(J.Dd,{ariaColIndex:0,children:(0,ue.jsx)(J.Du,{uri:e,playAriaLabel:d.ag.get("tracklist.a11y.play",n,S),onClick:(e,t)=>{N({loggingParams:t})},isPlaying:F,isActive:B,spec:L,children:(0,ue.jsx)(J.km,{children:T})})}),(0,ue.jsxs)(J.vZ,{ariaColIndex:1,children:[(0,ue.jsx)(J.lD,{src:h}),(0,ue.jsxs)(J.vm,{children:[(0,ue.jsx)(J.Wh,{titleText:n,children:n}),E&&(0,ue.jsxs)(J.g3,{children:[w.enhanced&&(0,ue.jsx)(V._,{iconSize:16,className:W.Z.enhanced,title:d.ag.get("web-player.enhance.button_text_enhanced"),"aria-label":d.ag.get("web-player.enhance.button_text_enhanced")}),w.download&&(0,ue.jsx)(ee.G,{size:16}),w.explicit&&(0,ue.jsx)(te.N,{}),w.paid&&(0,ue.jsx)(G.g,{}),w.nineteen&&(0,ue.jsx)(ne.X,{className:W.Z.nineteen,size:16})]}),(0,ue.jsx)(J.K9,{children:(0,ue.jsx)(J.T6,{artists:U,spec:L})})]})]}),(0,ue.jsx)(J.UA,{ariaColIndex:2,children:s&&(0,ue.jsx)(J.BM,{uri:s.uri,name:s.name,creatorUri:U?.[0]?.uri,spec:L,children:s.name})}),(0,ue.jsx)(J.UA,{ariaColIndex:3,children:(0,ue.jsx)(J.p_,{name:R?.name||R?.id||"",uri:R?.id&&l().profileURI(R.id).toURI()||"",imageUrl:R?.avatar?.sources&&(0,X.X)(R?.avatar?.sources,{desiredWidth:24,desiredLabel:"small"})?.url||"",showAvatar:!0})}),(0,ue.jsx)(J.UA,{ariaColIndex:4,children:v?(0,ue.jsx)(J.Op,{dateAdded:v}):null}),(0,ue.jsxs)(J.mU,{ariaColIndex:5,children:[y?(0,ue.jsxs)(ue.Fragment,{children:[f?(0,ue.jsx)(re.T,{id:"enhance-add-recommendation",bodyText:d.ag.get("web-player.enhance.onboarding.add-recommendation-to-playlist"),shouldScrollIntoView:!0,children:O}):O,(0,ue.jsx)(me,{onClick:()=>{I([t]),M.logInteraction(L.removeRecommendationButtonFactory().hitRemoveRecommendation({recommendedItemUri:e,contextUri:g}))},label:d.ag.get("web-player.enhance.button_label_remove_from_playlist"),Icon:H.H})]}):(0,ue.jsx)(J.qS,{uri:e,type:"track",spec:L}),(0,ue.jsx)(J.A$,{duration:a}),(0,ue.jsx)(J.Zv,{menu:A,label:d.ag.get("more.label.track",n,S),spec:L})]})]})})})})),ge=[O.Q.INDEX,O.Q.TITLE,O.Q.ALBUM,O.Q.ADDED_BY,O.Q.ADDED_AT,O.Q.DURATION],xe=a.memo((function({ariaLabel:e,uri:t,name:n,usePlayContextItem:i,tracklistRef:s,fetchTracks:r,addRecommendation:l,removeItems:o,nrTracks:c,canBeRemovedFromPlaylist:u}){const m=(0,a.useRef)(!1),h=(0,z.k)();(0,a.useEffect)((()=>{m.current&&h&&s?.current?.update(),m.current=!0}),[h,s]);const g=50,x=(0,a.useRef)((()=>{})),[y,p]=(0,a.useState)([]),{logger:f,spec:b,UBIFragment:I}=(0,C.fU)(N.createDesktopTrackListEventFactory,{data:{uri:t,identifier:"enhanced-tracklist"}}),j=(0,a.useCallback)((()=>{if(s&&s.current){const{firstIndex:e,lastIndex:t}=s.current.getVisibleTrackWindow(),n=t-e;return Math.max(0,e-Math.round((g-n)/2))}return 0}),[s]),R=(0,a.useCallback)((e=>{x.current(),o({itemIds:e.map((({id:e})=>e)),offset:j(),limit:g});const n=new Set(e.map((({id:e})=>e))),a=s?.current?.getRows()||[],i=[];if(a.forEach(((e,t)=>{if(e&&n.has(e.uid)){const n={index:t,item:e};e.isEnhanced&&i.push(n)}})),i.length){let e;e=1===i.length?(0,D.createDesktopTrackListRowEventFactory)({data:{uri:i[0].item.uri,position:i[0].index,reason:""}}).removeRecommendationButtonFactory().hitRemoveRecommendation({contextUri:t,recommendedItemUri:i[0].item.uri}):b.removeItemsButtonFactory().hitRemoveRecommendations({contextUri:t,numberOfRecommendationsToRemove:i.length}),e&&f.logInteraction(e)}}),[o,j,f,s,t,b]),v=(0,a.useCallback)((async(e,t)=>({items:await r(e,t),totalLength:c})),[r,c]),k=(0,a.useCallback)(((e,t)=>{x.current=t,e.length>1?p(e):R(e)}),[R]),P=(0,a.useCallback)((e=>{l({itemIds:[e],offset:j(),limit:g})}),[l,j]),w=(0,a.useCallback)((e=>{o({itemIds:e,offset:j(),limit:g})}),[o,j]),E=(0,a.useCallback)((function(e,n){const a=(0,X.X)(e.albumOfTrack?.coverArt?.sources,{desiredSize:40,desiredLabel:"small"});return(0,ue.jsx)(he,{index:n,playIndex:n,contextUri:t,uri:e.uri,uid:e.uid,isPlayable:e.playability.playable,durationMs:e.duration.totalMilliseconds,name:e.name,artists:e.artists,album:e.albumOfTrack,isExplicit:e.contentRating?.label===K.KS.Explicit,isMOGEFRestricted:e.contentRating?.label===K.KS.NineteenPlus,imgUrl:a?.url||"",usePlayContextItem:i,isEnhanced:e.isEnhanced,playContextPageIndex:e.playContextPageIndex,isFirstRecommendation:e.isFirstRecommendationOfPage&&n<g,add:P,remove:w,canBeRemovedFromPlaylist:u,addedBy:e.addedBy,addedAt:e.addedAt},e.uid)}),[i,t,P,w,u]),T=(0,a.useCallback)((e=>e.uri),[]),U=(0,a.useCallback)((e=>e.uid),[]);return(0,ue.jsxs)(I,{spec:b,children:[(0,ue.jsx)($.ZP,{value:"playlist-tracklist",children:(0,ue.jsx)(M.Pv,{testID:"playlist-tracklist",ariaLabel:e,hasHeaderRow:!0,columns:ge,onRemove:k,renderRow:E,resolveUri:T,resolveUid:U,nrTracks:c,fetchTracks:v,limit:g,outerRef:s},t)}),(0,ue.jsx)(L.h,{title:d.ag.get("playlist.remove_from_playlist",n),isOpen:y.length>0,tracks:y,onClose:e=>{e.stopPropagation(),p([])},onRemove:R})]})}));var ye=n(74954),pe=n(65241),fe=n(73540),be=n(37618),Ie=n(4285),je=n(58512);const Re="z9JdxJgW3OxYysR2dkal";function ve(e){return"function"==typeof e}const ke=function({contextUri:e,title:t,message:n,children:i}){const s=(0,a.useRef)(null),[r,l]=(0,a.useState)(!1),[o,c]=(0,a.useState)("topStart"),u=(0,a.useCallback)((()=>{l(!1),s.current?.focus()}),[]),m=(0,a.useCallback)((()=>{l(!0)}),[]),{setIsEnhanced:h}=(0,A.U)(e),g=(0,a.useRef)(null);return(0,a.useEffect)((()=>{if(g.current){if(!g.current)return;const{top:e,bottom:t}=g.current.getBoundingClientRect(),n=16;e<n?c("bottomStart"):t>window.innerHeight-n&&c("topStart")}}),[r]),(0,ue.jsx)(ye.x,{onShow:m,onHide:u,placement:o,withPortal:!0,overlay:r&&(0,ue.jsx)(je.i,{children:(0,ue.jsx)("div",{className:"encore-dark-theme",ref:g,children:(0,ue.jsxs)(pe.J,{role:"alertdialog",popoverTitle:t,arrow:"topStart"===o?"bottomEnd":"topEnd",colorSet:"announcement",children:[n,(0,ue.jsxs)("div",{className:Re,children:[(0,ue.jsx)(fe.o,{buttonSize:be.z.sm,onClick:u,children:d.ag.get("web-player.enhance.missing-functionality-callout.dismiss")}),(0,ue.jsx)(Ie.D,{buttonSize:be.z.sm,onClick:()=>{u(),h(!1)},colorSet:"invertedLight",children:d.ag.get("web-player.enhance.missing-functionality-callout.turn-off-enhance")})]})]})})}),children:ve(i)?(0,ue.jsx)(ue.Fragment,{children:i(m)}):i})},Ce="A4dupilHPIEDfhXDE0m0",Pe="JYAfUd8XXrVwcPbq9QaC",we=a.memo((function({metadata:e,capabilities:t,featureIdentifier:n}){const{uri:r,name:N,images:D,totalLength:L}=e,[M]=D,O=(0,R.Z)(M?.url||null),z=(0,s.TH)(),$=(0,s.ur)(),K=(0,i.I0)(),X=(0,j.o)(),Z=(0,a.useRef)(null),V=l().isPlaylistV1OrV2(r),{isEnhanced:H,playContext:Q,numTotalItems:G,numTotalRecs:J,addRecommendation:W,removeItems:Y,fetchTracks:q,enhancedInvalidationKey:ee,shouldUnderlyingContextChangeRefreshView:te,UBIReason:ne,clearCache:ae,fetchIndexOfItemId:ie}=function(e){const t=(0,U._)(),{isEnhanced:n,iteration:i,setIsEnhanced:s,toggleIsEnhanced:r}=(0,A.U)(e),[l,o]=(0,a.useState)(null),c=(0,a.useRef)(Date.now()),d=(0,a.useCallback)((()=>Date.now()-c.current>3e3),[]),u=(0,a.useRef)({}),m=(0,a.useRef)(null),h=(0,a.useCallback)((async(e,n,a,i,s,r,l)=>{r&&(c.current=Date.now());const d=m.current?.enhancedRevision;let h;try{h=await l}catch(r){409===r?.status&&(h=await t.getPage(e,n,a,i,s))}const g=h?.enhancePage;if(!g)return[];const{pageItems:x,...y}=g,p=await t.decoratePageItems(x);return d!==m.current?.enhancedRevision?[]:(m.current?.enhancedRevision!==y.enhancedRevision&&(r=!0),u.current=function(e,t,n,a){const i=a?{}:{...e};return t.forEach(((e,t)=>{i[n+t]=e})),i}(u.current,p,i,r),o(y),m.current=y,p)}),[t]),g=(0,a.useCallback)((async({itemIds:n,offset:a=0,limit:s=1})=>{m.current&&i&&h(e,i,m.current.sessionId,a,s,!0,t.addRecommendation(e,m.current.sessionId,n,a,s))}),[h,e,t,i]),x=(0,a.useCallback)((async({itemIds:n,offset:a=0,limit:s=1})=>{if(!m.current||!i)return;const r=u.current,l=new Set(n);let o=!1;for(const e in r)if(l.has(r[e].uid)&&r[e].isEnhanced){o=!0;break}h(e,i,m.current.sessionId,a,s,!0,t.removeItems(e,m.current.sessionId,n,a,s,o))}),[h,e,t,i]),y=(0,a.useMemo)((()=>new T.tL),[]),p=(0,a.useCallback)((async(n,a)=>{if(!i)return[];const s=Math.min(a,(m.current?.numTotalItems||1/0)-n),r=Array.from({length:s},((e,t)=>u.current[t+n]));return r.every((e=>!!e))&&0!==s?r:h(e,i,m.current?.sessionId,n,a,!1,y.create(`${e}:${i}:${m.current?.sessionId}:${n}:${a}`,(()=>t.getPage(e,i,m.current?.sessionId,n,a))))}),[y,h,e,t,i]),f=(0,a.useMemo)((()=>({uri:e,url:l?.dspContextUri})),[e,l?.dspContextUri]),b=(0,a.useCallback)((()=>{u.current={}}),[]),I=(0,a.useCallback)((async n=>{if(!i)return-1;const{enhancePage:a}=await t.getPage(e,i,m.current?.sessionId,0,t.MAX_PAGE_SIZE);return a?.pageItems.findIndex((e=>e.itemId===n))??-1}),[t,i,e]);return{isEnhanced:n,setIsEnhanced:s,toggleIsEnhanced:r,addRecommendation:g,removeItems:x,playContext:f,numTotalItems:isNaN(Number(l?.numTotalItems))?void 0:Number(l?.numTotalItems),numTotalRecs:isNaN(Number(l?.numTotalRecs))?void 0:Number(l?.numTotalRecs),fetchTracks:p,clearCache:b,enhancedInvalidationKey:`${l?.enhancedRevision??""}${i??""}`,shouldUnderlyingContextChangeRefreshView:d,UBIReason:l?`enhanced|${l?.sessionId}#${l?.logging?.correlationId}`:"enhanced|",fetchIndexOfItemId:I}}(r),se=(G??L)>0,re=t?.canFilter&&L>0,le=t?.canSort&&L>0;(0,a.useEffect)((()=>{if(H&&"POP"!==$){const e=new URLSearchParams(z.search).get("uid");if(!e)return;ie(e).then((e=>{-1!==e&&Z.current?.scrollToIndex(e)}))}}),[ie,H,$,z.search]),(0,a.useEffect)((()=>{ee&&Z.current?.update()}),[ee]),(0,a.useEffect)((()=>{te()&&(ae(),Z.current?.update())}),[L,ae,te]);const{spec:oe,logger:ce,UBIFragment:de}=(0,C.fU)(o.createDesktopEnhancedEventFactory,{data:{uri:r,identifier:"enhanced-session",reason:ne}}),me=(0,a.useMemo)((()=>({header:oe.headerFactory()})),[oe]),{isPlaying:he,isActive:ge,togglePlay:ye,usePlayContextItem:pe}=(0,k.n)(Q,{featureIdentifier:n}),fe=(0,a.useCallback)((()=>{let e;ye(),e=ge?he?oe.playButtonFactory().hitPause({itemToBePaused:r}):oe.playButtonFactory().hitResume({itemToBeResumed:r}):oe.playButtonFactory().hitPlay({itemToBePlayed:r}),ce.logInteraction(e)}),[ye,he,ge,ce,oe,r]),be=function(e=0){const{data:t}=(0,S.J)(B.n5.getUser,["spotify"]);return(0,a.useMemo)((()=>t?.body?{isOwner:!1,tracksAdded:e,user:{uri:t.body.uri,type:F.p.USER,username:t.body.id,displayName:t.body.display_name,images:t.body.images}}:null),[t,e])}(J),Ie=e.collaborators?.items?.concat()??[];be&&Ie.splice(P.ms-1,0,be);const je={count:Ie.length,items:Ie},Re=(0,a.useCallback)(((e,t)=>{const n=[...t[I.aN[l().Type.ALBUM]]||[],...t[I.aN[l().Type.TRACK]]||[]];n.length>0&&(K((0,u.jV)(r,n)),X({targetUri:r,intent:"add",type:"drop"}))}),[K,X,r]);return(0,ue.jsx)(a.Suspense,{fallback:null,children:(0,ue.jsx)(E.e,{pageId:c.Wg.ENHANCED_SESSION,children:(0,ue.jsxs)(de,{spec:oe,children:[(0,ue.jsx)(y.$,{children:d.ag.get("playlist.page-title",N)}),(0,ue.jsx)(x.Z,{types:[I.aN[l().Type.ALBUM],I.aN[l().Type.TRACK]],onDrop:Re,children:(0,ue.jsxs)("section",{role:"presentation",className:Ce,"data-testid":"enhanced-page",children:[(0,ue.jsxs)(de,{spec:me.header,children:[(0,ue.jsx)(b.s,{metadata:{...e,collaborators:je,duration:void 0,totalLength:G??L},isPlaying:he,togglePlay:fe,backgroundColor:O}),(0,ue.jsx)("div",{children:(0,ue.jsx)(m.o,{backgroundColor:O,children:(0,ue.jsxs)(m.F,{children:[se?(0,ue.jsx)(p.$,{onClick:fe,isPlaying:he,size:"lg",uri:r}):null,(0,ue.jsx)(_.v,{uri:r}),V&&(0,ue.jsx)(v.y,{menu:(0,ue.jsx)(g.X,{uri:r,isEnhanced:H}),children:(0,ue.jsx)(h.z,{})}),(re||le)&&(0,ue.jsxs)("div",{className:Pe,children:[re&&(0,ue.jsx)(a.Suspense,{fallback:null,children:(0,ue.jsx)(ke,{contextUri:r,title:d.ag.get("web-player.enhance.missing-functionality-callout.filtering-playlist-disabled-title"),message:d.ag.get("web-player.enhance.missing-functionality-callout.filtering-playlist-disabled-message"),children:e=>(0,ue.jsx)(w.K,{placeholder:d.ag.get("playlist.search_in_playlist"),onActivate:()=>(e(),!1)})})}),le&&(0,ue.jsx)(ke,{contextUri:r,title:d.ag.get("web-player.enhance.missing-functionality-callout.sorting-playlist-disabled-title"),message:d.ag.get("web-player.enhance.missing-functionality-callout.sorting-playlist-disabled-message"),children:(0,ue.jsx)(f.l,{columns:[],disabled:!0})})]})]})})})]}),(0,ue.jsx)("div",{className:"contentSpacing",children:(0,ue.jsx)(a.Suspense,{fallback:null,children:(0,ue.jsx)(xe,{ariaLabel:N,nrTracks:G??Math.max(15,L),uri:r,name:N,usePlayContextItem:pe,tracklistRef:Z,fetchTracks:q,addRecommendation:W,removeItems:Y,canBeRemovedFromPlaylist:V},r)})})]})})]})})})}))}}]);
//# sourceMappingURL=7353.js.map